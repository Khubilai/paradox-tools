#!/usr/bin/env ruby

require_relative "../lib/paradox_mod_builder"

class NoLocalizedTitlesModBuilder < ParadoxModBuilder
  def cultures
    cultures = ["north_germanic", "central_germanic", "west_germanic", "latin", "iberian", "byzantine", "celtic", "finno_ugric", "baltic", "altaic", "arabic", "east_slavic", "west_slavic", "south_slavic", "magyar", "iranian", "east_african", "west_african", "mesoamerican", "israelite", "indo_aryan_group", "dravidian_group", "norse", "swedish", "norwegian", "danish", "german", "lombard", "old_frankish", "suebi", "english", "saxon", "old_saxon", "frisian", "dutch", "frankish", "norman", "italian", "occitan", "roman", "basque", "castillan", "catalan", "portuguese", "visigothic", "armenian", "greek", "alan", "georgian", "irish", "scottish", "pictish", "welsh", "breton", "finnish", "lappish", "ugricbaltic", "komi", "khanty", "samoyed", "mordvin", "lettigallish", "lithuanian", "prussian", "turkish", "pecheneg", "cuman", "khazar", "bolghar", "avar", "karluk", "kirghiz", "mongol", "bedouin_arabic", "maghreb_arabic", "levantine_arabic", "egyptian_arabic", "andalusian_arabic", "russian", "ilmenian", "severian", "volhynian", "pommeranian", "bohemian", "polish", "croatian", "serbian", "romanian", "bulgarian", "hungarian", "persian", "kurdish", "afghan", "baloch", "ethiopian", "somali", "nubian", "manden", "nahuatl", "ashkenazi", "sephardi", "bengali", "oriya", "assamese", "hindustani", "gujurati", "panjabi", "rajput", "sindhi", "marathi", "sinhala", "tamil", "telugu", "kannada"]
  end

  def no_localized_landed_titles!(node)
    cultures.each do |culture|
      node.delete(culture)
    end

    node.each do |key, val|
      next if val.is_a?(Numeric) or val == true or val == false
      case key
      when /\A[ekdcb]_/
        no_localized_landed_titles!(val)
      when *%W[
        color color2 dignity culture capital title title_female tribe holy_site
        foa controls_religion religion allow mercenary_type coat_of_arms
        male_names pagan_coa gain_effect graphical_culture
      ]
        # OK
      when *%W[]
      else
        puts "Unknown node: #{key} #{val.class} #{val}"
      end
    end
  end

  def build_mod_files!
    patch_mod_files!("common/landed_titles/*.txt") do |node|
      node.each do |title_name, title_node|
        no_localized_landed_titles!(title_node)
      end
    end
    # There's also localization like d_york_adj_norse
    # but it doesn't seem to be used if we cleanup landed titles
  end
end

mb = NoLocalizedTitlesModBuilder.new(
  ParadoxGame.new(
    "source/ck2_2.3.4",
  ),
  "output/no_localized_landed_titles",
)
mb.build!
